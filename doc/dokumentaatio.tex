\documentclass[10pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{emp}
\usepackage{ifpdf,graphicx}
\ifpdf
  \DeclareGraphicsRule{*}{mps}{*}{}
\fi

\begin{document}
\begin{empfile}
\begin{empcmds}
input metauml;
\end{empcmds}
\section{Johdanto}
Tsohachanin tarkoituksena on tarjota aito lauta kokemus. Tsohachan mahdollistaa käyttäjien luoda uusia lankoja ja lähettää uusia viestejä jo olemassa oleviin lankoihin. Thohachan mahdollistaa hilpeiden meemujen jakamisen kaikille niistä tykkääville. Tsohachan toimii php + postgresql combolla. Työ toimii laitoksen users serverillä. 
\section{Käyttötapaukset}
\begin{center}
\begin{emp}[tapaukset](200, 100)
Usecase.C("Creating thread");
C.ne = (.5w, 0);
Usecase.S("Sending message");
S.ne = (.5w, .25h);
Usecase.D("Deleting thread");
D.ne = (.5w, .5h);
Usecase.B("Banning IP");
B.ne = (.5w, .75h);
Usecase.L("Login");
L.ne = (.5w, h);
Actor.U("User");
U.ne = (0, .25h);
Actor.A("Admin");
A.ne = (w, .5h);
drawObjects(C, S, U, A, D, B, L);
link(association)(U.e -- C.w);
link(association)(U.e -- S.w);
link(association)(A.w -- C.e);
link(association)(A.w -- S.e);
link(association)(A.w -- D.e);
link(association)(A.w -- L.e);
\end{emp}
\end{center}
\section{Järjestelmän tietosisältö}
\begin{center}
\begin{emp}[tieto](150, 75)
Class.T("Thread")()();
T.ne = (0, 0);
Class.P("Post")()();
P.ne = (w, 0);
Class.O("Board")()();
O.ne = (0, h);
Class.E("User")()();
E.ne = (w, h);
Class.M("Admin")()();
M.ne = (w/2, h);
drawObjects(T, P, O, E, M);
draw T.e -- P.w;
item(iAssoc)("1")(obj.nw = T.e);
item(iAssoc)("1..*")(obj.ne = P.w);
draw O.s -- T.n;
item(iAssoc)("1")(obj.nw = O.s);
item(iAssoc)("0..*")(obj.sw = T.n);
draw E.s -- P.n;
item(iAssoc)("1")(obj.nw = E.s);
item(iAssoc)("1..*")(obj.sw = P.n);
draw O.e -- M.w;
item(iAssoc)("1..*")(obj.nw = O.e);
item(iAssoc)("1..*")(obj.ne = M.w);
\end{emp}
\end{center}
\begin{center}
\begin{emp}[kanta](200, 125)
Class.H("Thread")("<<key>> id: int",
				 "<<key, fkey>> boardId: String",
				 "creationTime: timestamp")();
H.ne = (w, 0);
Class.R("Board")("<<key>> id: String",
				"description: String")();
R.ne = (0, 0);
Class.Q("BoardAdmin")("<<key, fkey>> adminId: String",
					 "<<key, fkey>> boardId: String")();
Q.ne = (.25w, .45h);
Class.N("Admin")("<<key>> name: String",
				"email: String",
				"hash: int",
				"salt: int")();
N.ne = (0, h);
Class.J("Post")("<<key>> id: int",
				"<<key, fkey>> threadId: int",
				"<<fkey>> userID",
				"content: String")();
J.ne = (w, h);
Class.W("User")("<<key>> id: int",
				"ip: String")();
W.ne = (w, .5h);
Class.Y("Banned")("<<key>> ip: String")();
Y.ne = (.5w, 0);
drawObjects(H, R, Q, N, J, W, Y);
def lerp(expr a, b, p) =
	(1-p)*a+p*b
enddef;
pair adminid, adminfid, boardid, boardfid;
adminid := lerp(N.nw, N.sw, .3);
adminfid := lerp(Q.nw, Q.sw, .45);
boardid := lerp(R.nw, R.sw, .4);
boardfid := lerp(Q.nw, Q.sw, .65);
draw adminid -- adminid-(10, 0);
draw adminid-(10, 0) -- ((xpart N.sw) - 10, ypart adminfid);
draw ((xpart N.sw) - 10, ypart adminfid) -- adminfid;
draw boardid -- boardid-(10, 0);
draw boardid-(10, 0) -- ((xpart R.nw) - 10, ypart boardfid);
draw ((xpart R.nw) - 10, ypart boardfid) -- boardfid;
\end{emp}
\end{center}
\end{empfile}
\end{document}

